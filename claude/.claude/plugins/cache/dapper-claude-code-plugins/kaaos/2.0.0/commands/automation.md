---
description: Set up, manage, and control automated reviews (daily/weekly/monthly/quarterly) via macOS launchd
argument-hint: "[install|enable|disable|uninstall|status]"
---

# KAAOS Automation Setup

Set up automated periodic reviews that run in the background.

## Usage

```bash
# Install automation (creates scripts and schedules)
/kaaos:automation install

# Check automation status
/kaaos:automation status

# Enable all automated reviews
/kaaos:automation enable

# Disable all automated reviews
/kaaos:automation disable

# Uninstall automation
/kaaos:automation uninstall
```

## What This Creates

**Automation scripts** in ~/.kaaos/automation/:
- `daily-review.sh` - Runs at 7 AM daily
- `weekly-synthesis.sh` - Runs Monday 6 AM
- `monthly-review.sh` - Runs 1st of month at 5 AM
- `quarterly-analysis.sh` - Runs Jan/Apr/Jul/Oct 1st at 3 AM

**Launchd agents** in ~/Library/LaunchAgents/:
- `com.kaaos.daily-review.plist`
- `com.kaaos.weekly-synthesis.plist`
- `com.kaaos.monthly-review.plist`
- `com.kaaos.quarterly-analysis.plist`

## Implementation

You are the KAAOS Orchestrator handling automation setup.

### Phase 1: Parse Action

Extract action from $ARGUMENTS: install, status, enable, disable, or uninstall.

If no action or invalid action, display usage:
```
Usage: /kaaos:automation [action]

Actions:
  install    - Create automation scripts and schedules
  status     - Show current automation status
  enable     - Enable all automated reviews
  disable    - Disable all automated reviews
  uninstall  - Remove all automation

Example:
  /kaaos:automation install
```

### Phase 2: Locate KAAOS Repository

Use Bash to find repository:
```bash
if [ -d .kaaos ]; then
  echo "$PWD"
elif [ -d ~/kaaos-knowledge/.kaaos ]; then
  echo "$HOME/kaaos-knowledge"
else
  echo "NOT_FOUND"
fi
```

If NOT_FOUND, error: "Initialize KAAOS first with /kaaos:init"

Load config to get repository path.

### Phase 3A: Install Automation

If action is "install":

**Step 1: Create automation directory**

Use Bash:
```bash
mkdir -p ~/.kaaos/automation
mkdir -p ~/.kaaos/logs
```

**Step 2: Generate daily-review.sh**

Use Write tool to create ~/.kaaos/automation/daily-review.sh:

```bash
#!/usr/bin/env bash
set -euo pipefail

# Daily Review Script - Generated by KAAOS
# Runs daily at 7 AM to generate morning digest

KAAOS_REPO="${KAAOS_REPO:-$HOME/kaaos-knowledge}"
LOG_FILE="$HOME/.kaaos/logs/daily-review.log"

log() {
    echo "[$(date -Iseconds)] $*" | tee -a "$LOG_FILE"
}

log "Starting daily review..."

# Navigate to repository
cd "$KAAOS_REPO" || {
    log "ERROR: Cannot access $KAAOS_REPO"
    exit 1
}

# Check budget (read from config)
daily_limit=$(grep -A 5 "daily_limit_usd:" .kaaos/config.yaml | grep "daily_limit_usd:" | awk '{print $2}')

# Get today's spending
today=$(date +%Y-%m-%d)
spending=$(cat .kaaos/state/agent-executions.json 2>/dev/null | jq -r --arg today "$today" '
  [.executions[] |
   select(.started_at > (now - 86400) * 1000) |
   .cost_usd // 0] | add // 0
')

# Check if within budget
if (( $(echo "$spending + 0.50 > $daily_limit" | bc -l) )); then
    log "ERROR: Daily budget exceeded ($spending / $daily_limit)"
    exit 3
fi

log "Budget check passed: \$$spending / \$$daily_limit"

# Execute review via Claude Code
log "Running /kaaos:review daily..."

# This would ideally call Claude Code programmatically
# For now, create a marker that user can process
cat > .kaaos/automation/daily-review-pending.json <<JSONEOF
{
  "type": "daily",
  "date": "$(date +%Y-%m-%d)",
  "scheduled_at": "$(date -Iseconds)",
  "status": "pending"
}
JSONEOF

log "Daily review task created. Run: claude-code -c '/kaaos:review daily' to process"
log "Or process pending reviews with: /kaaos:automation process-pending"

# TODO: When Claude Code supports programmatic invocation, execute directly
# For now, user must run manually or set up separate automation

exit 0
```

Make executable:
```bash
chmod +x ~/.kaaos/automation/daily-review.sh
```

**Step 3: Generate weekly-synthesis.sh**

Similar script for weekly (Monday 6 AM).

**Step 4: Generate monthly-review.sh**

Similar script for monthly (1st at 5 AM).

**Step 5: Generate quarterly-analysis.sh**

Similar script for quarterly.

**Step 6: Generate launchd plist files**

Use Write tool to create ~/Library/LaunchAgents/com.kaaos.daily-review.plist:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.kaaos.daily-review</string>

    <key>ProgramArguments</key>
    <array>
        <string>/Users/USERNAME/.kaaos/automation/daily-review.sh</string>
    </array>

    <key>StartCalendarInterval</key>
    <dict>
        <key>Hour</key>
        <integer>7</integer>
        <key>Minute</key>
        <integer>0</integer>
    </dict>

    <key>StandardOutPath</key>
    <string>/Users/USERNAME/.kaaos/logs/daily-review.log</string>

    <key>StandardErrorPath</key>
    <string>/Users/USERNAME/.kaaos/logs/daily-review-error.log</string>

    <key>Disabled</key>
    <true/>
</dict>
</plist>
```

Replace USERNAME with actual username (from $HOME).

Create similar plists for weekly, monthly, quarterly.

**Step 7: Load launchd agents**

Use Bash to load agents:
```bash
launchctl load ~/Library/LaunchAgents/com.kaaos.daily-review.plist
launchctl load ~/Library/LaunchAgents/com.kaaos.weekly-synthesis.plist
launchctl load ~/Library/LaunchAgents/com.kaaos.monthly-review.plist
launchctl load ~/Library/LaunchAgents/com.kaaos.quarterly-analysis.plist
```

**Step 8: Display success**

```
┌─────────────────────────────────────────────────────────────────┐
│              KAAOS Automation Installed                          │
└─────────────────────────────────────────────────────────────────┘

Scripts Created:
  ~/.kaaos/automation/daily-review.sh
  ~/.kaaos/automation/weekly-synthesis.sh
  ~/.kaaos/automation/monthly-review.sh
  ~/.kaaos/automation/quarterly-analysis.sh

Launchd Agents Created (disabled by default):
  ~/Library/LaunchAgents/com.kaaos.daily-review.plist
  ~/Library/LaunchAgents/com.kaaos.weekly-synthesis.plist
  ~/Library/LaunchAgents/com.kaaos.monthly-review.plist
  ~/Library/LaunchAgents/com.kaaos.quarterly-analysis.plist

Next Steps:
  1. Review schedules: /kaaos:automation status
  2. Enable automation: /kaaos:automation enable
  3. Test manually: ~/.kaaos/automation/daily-review.sh

Note: Automation creates pending tasks that you process with:
  /kaaos:automation process-pending

Or configure Claude Code CLI for direct execution (advanced).
```

### Phase 3B: Show Status

If action is "status":

Use Bash to check launchd agents:
```bash
launchctl list | grep com.kaaos
```

For each agent found:
```bash
launchctl print user/$UID/com.kaaos.daily-review
```

Extract enabled/disabled status and last run time.

Display:
```
KAAOS Automation Status

Daily Review (7:00 AM)
  Status: Enabled
  Last Run: Today 7:02 AM
  Next Run: Tomorrow 7:00 AM
  Log: ~/.kaaos/logs/daily-review.log

Weekly Synthesis (Monday 6:00 AM)
  Status: Disabled
  Last Run: Never
  Next Run: Mon Jan 20 6:00 AM (if enabled)
  Log: ~/.kaaos/logs/weekly-synthesis.log

Monthly Review (1st, 5:00 AM)
  Status: Enabled
  Last Run: Jan 1 5:01 AM
  Next Run: Feb 1 5:00 AM
  Log: ~/.kaaos/logs/monthly-review.log

Quarterly Analysis (Jan/Apr/Jul/Oct 1st, 3:00 AM)
  Status: Disabled
  Last Run: Never
  Next Run: Apr 1 3:00 AM (if enabled)
  Log: ~/.kaaos/logs/quarterly-analysis.log

───────────────────────────────────────────────────────────────

Pending Tasks: 2
  • daily review for 2026-01-12 (process with: /kaaos:automation process-pending)
  • weekly synthesis for 2026-W02

Commands:
  Enable all: /kaaos:automation enable
  Disable all: /kaaos:automation disable
  Uninstall: /kaaos:automation uninstall
```

### Phase 3C: Enable Automation

If action is "enable":

Use Bash to enable all agents:
```bash
launchctl enable user/$UID/com.kaaos.daily-review
launchctl enable user/$UID/com.kaaos.weekly-synthesis
launchctl enable user/$UID/com.kaaos.monthly-review
launchctl enable user/$UID/com.kaaos.quarterly-analysis

# Also start them (load if not loaded)
launchctl kickstart user/$UID/com.kaaos.daily-review
```

Display:
```
✓ Daily reviews enabled (7:00 AM daily)
✓ Weekly synthesis enabled (Monday 6:00 AM)
✓ Monthly reviews enabled (1st of month, 5:00 AM)
✓ Quarterly analysis enabled (Quarterly, 3:00 AM)

Automation is now active.

Check status: /kaaos:automation status
View logs: tail -f ~/.kaaos/logs/daily-review.log
```

### Phase 3D: Disable Automation

If action is "disable":

Use Bash to disable all agents:
```bash
launchctl disable user/$UID/com.kaaos.daily-review
launchctl disable user/$UID/com.kaaos.weekly-synthesis
launchctl disable user/$UID/com.kaaos.monthly-review
launchctl disable user/$UID/com.kaaos.quarterly-analysis
```

Display:
```
✓ All automation disabled

Scripts remain installed but won't run automatically.

Re-enable with: /kaaos:automation enable
```

### Phase 3E: Uninstall Automation

If action is "uninstall":

Use Bash to unload and remove agents:
```bash
launchctl unload ~/Library/LaunchAgents/com.kaaos.*.plist 2>/dev/null
rm -f ~/Library/LaunchAgents/com.kaaos.*.plist
rm -rf ~/.kaaos/automation/
```

Display:
```
✓ Launchd agents removed
✓ Automation scripts removed

Automation fully uninstalled.

Reinstall anytime with: /kaaos:automation install
```

### Phase 4: Process Pending Reviews (Bonus)

If action is "process-pending":

Use Glob to find pending review markers:
```bash
find ~/.kaaos/automation -name "*-pending.json"
```

For each pending review:
1. Read the JSON to get review type and date
2. Execute: `/kaaos:review [type] [date]`
3. Delete the pending marker
4. Mark as processed

Display:
```
Processing 2 pending reviews...

✓ Daily review for 2026-01-12 (cost: $0.30)
✓ Weekly synthesis for 2026-W02 (cost: $4.50)

Total cost: $4.80

All pending reviews processed.
View digests: /kaaos:digest daily
```

## Automation Script Template

### daily-review.sh

```bash
#!/usr/bin/env bash
set -euo pipefail

KAAOS_REPO="${KAAOS_REPO:-$HOME/kaaos-knowledge}"
LOG_FILE="$HOME/.kaaos/logs/daily-review-$(date +%Y-%m-%d).log"

log() {
    echo "[$(date -Iseconds)] $*" | tee -a "$LOG_FILE"
}

log "=== Daily Review Started ==="

# Check repository exists
if [ ! -d "$KAAOS_REPO/.kaaos" ]; then
    log "ERROR: KAAOS repository not found at $KAAOS_REPO"
    exit 1
fi

cd "$KAAOS_REPO"

# Check budget
daily_limit=$(grep "daily_limit_usd:" .kaaos/config.yaml | awk '{print $2}')
today_spending=$(cat .kaaos/state/agent-executions.json | jq -r '
  [.executions[] |
   select(.started_at > (now - 86400) * 1000) |
   .cost_usd // 0] | add // 0
')

if (( $(echo "$today_spending + 0.50 > $daily_limit" | bc -l) )); then
    log "ERROR: Budget exceeded (\$$today_spending / \$$daily_limit)"
    exit 3
fi

log "Budget check passed (\$$today_spending / \$$daily_limit)"

# Create pending task marker
mkdir -p .kaaos/automation
cat > .kaaos/automation/daily-review-pending.json <<EOF
{
  "type": "daily",
  "date": "$(date +%Y-%m-%d)",
  "created_at": "$(date -Iseconds)",
  "status": "pending"
}
EOF

log "Pending review created: .kaaos/automation/daily-review-pending.json"
log "Process with: claude-code -c '/kaaos:automation process-pending'"
log ""
log "Or run review directly: /kaaos:review daily"
log ""
log "=== Daily Review Task Created ==="

exit 0
```

### Launchd Plist Template

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.kaaos.daily-review</string>

    <key>ProgramArguments</key>
    <array>
        <string>/Users/USERNAME/.kaaos/automation/daily-review.sh</string>
    </array>

    <key>StartCalendarInterval</key>
    <dict>
        <key>Hour</key>
        <integer>7</integer>
        <key>Minute</key>
        <integer>0</integer>
    </dict>

    <key>StandardOutPath</key>
    <string>/Users/USERNAME/.kaaos/logs/daily-review.log</string>

    <key>StandardErrorPath</key>
    <string>/Users/USERNAME/.kaaos/logs/daily-review-error.log</string>

    <key>RunAtLoad</key>
    <false/>

    <key>Disabled</key>
    <true/>
</dict>
</plist>
```

## User-Friendly Flow

### Initial Setup

```bash
# User installs plugin
/plugin install github.com/user/kaaos

# Initialize repository
/kaaos:init personal

# Set up automation (one command!)
/kaaos:automation install

# Output:
✓ Created 4 automation scripts
✓ Created 4 launchd agents
✓ All agents installed but disabled

Enable now? [Y/n]

# If Yes:
✓ All automation enabled
✓ Daily reviews at 7 AM
✓ Weekly synthesis Monday 6 AM
✓ Monthly reviews 1st of month
✓ Quarterly analysis quarterly

Your knowledge base will now maintain itself!
```

### Daily User Experience

**7:00 AM**: daily-review.sh runs automatically
- Creates pending task marker
- Exits immediately

**When you open Claude Code**:
```bash
# Check if pending reviews
/kaaos:automation status

# Output:
Pending Reviews: 1
  • Daily review for today

Process now? [Y/n]

# If Yes, runs:
/kaaos:review daily

# Generates digest, displays:
Daily Digest Complete!
Read: /kaaos:digest daily
```

## Notes

- **Automation scripts are lightweight**: Just create task markers and check budgets
- **Actual reviews run in Claude Code**: When you process pending tasks
- **No programmatic Claude Code invocation** (not currently supported)
- **Two-step flow**: Script marks task pending → User processes in Claude Code
- **Alternative**: User can ignore automation and run `/kaaos:review daily` manually anytime

This provides **semi-automated** workflow:
1. Launchd creates scheduled task markers
2. User processes them when convenient
3. Still hands-off for scheduling logic
4. User stays in control of execution and cost

## Future Enhancement

When Claude Code supports programmatic invocation, scripts can execute directly:
```bash
# Future: Direct execution
claude-code --non-interactive --execute "/kaaos:review daily"
```

For now, marker-based approach provides scheduling without CLI automation.

## Error Handling

### Launchd Not Available (Linux)

```
Warning: launchd not available (macOS only)

For Linux, use cron instead:

Add to crontab:
  0 7 * * * ~/.kaaos/automation/daily-review.sh
  0 6 * * 1 ~/.kaaos/automation/weekly-synthesis.sh

Edit crontab: crontab -e
```

### Permission Denied

```
Error: Cannot write to ~/Library/LaunchAgents/

Check permissions:
  ls -ld ~/Library/LaunchAgents

Create directory if needed:
  mkdir -p ~/Library/LaunchAgents
```

### Scripts Not Executable

```
Error: Scripts not executable

Fix with:
  chmod +x ~/.kaaos/automation/*.sh
```

## Cost Impact

**Automation adds**:
- Daily reviews: ~$9/month (30 × $0.30)
- Weekly synthesis: ~$18/month (4 × $4.50)
- Monthly reviews: ~$12/month (1 × $12)
- Quarterly analysis: ~$15/month (0.33 × $45)
- **Total**: ~$54/month additional

Still within default $100/month budget!
